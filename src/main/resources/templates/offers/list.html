<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no">
    <title>Магазин</title>
    <th:block th:insert="~{fragments/links}"></th:block>
    <link rel="stylesheet" th:href="@{/css/toast.css}">
</head>

<body>
<!-- site -->
<div class="site">
    <!-- mobile site__header -->
    <th:block th:insert="~{fragments/header}"></th:block>
    <!-- site__body -->
    <div class="site__body">
        <div class="page-header">
            <div class="page-header__container container">
                <div class="page-header__title">
                    <h1>Магазин</h1>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="shop-layout shop-layout--sidebar--start">
                <div class="shop-layout__sidebar">
                    <div class="block block-sidebar block-sidebar--offcanvas--mobile">
                        <div class="block-sidebar__backdrop"></div>
                        <div class="block-sidebar__body">
                            <div class="block-sidebar__header">
                                <div class="block-sidebar__title">Filters</div>
                                <button class="block-sidebar__close" type="button">
                                    <svg width="20px" height="20px">
                                        <use xlink:href="images/sprite.svg#cross-20"></use>
                                    </svg>
                                </button>
                            </div>
                            <div class="block-sidebar__item">
                                <div class="widget-filters widget widget-filters--offcanvas--mobile" data-collapse
                                     data-collapse-opened-class="filter--opened">
                                    <h4 class="widget-filters__title widget__title">Филтри</h4>
                                    <form method="get" action="/offers">
                                        <div class="widget-filters__list">
                                            <!-- Categories Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Подкатегории
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <select class="form-control form-control-sm"
                                                                    id="subcategoryId" name="subcategoryId">
                                                                <option value="">Всички подкатегории</option>
                                                                <option th:each="subcategory : ${subcategories}"
                                                                        th:value="${subcategory.id}"
                                                                        th:text="${subcategory.name}"></option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Cities Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Градове
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <select class="form-control form-control-sm" id="cityId"
                                                                    name="cityId">
                                                                <option value="">Всички градове</option>
                                                                <option th:each="city : ${cities}" th:value="${city.id}"
                                                                        th:text="${city.name}"></option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Offer State Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Състояние на обявата
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <select class="form-control form-control-sm" id="offerState"
                                                                    name="offerState">
                                                                <option value="">Всички</option>
                                                                <option value="NEW">Нови</option>
                                                                <option value="USED">Използвани</option>
                                                                <option value="NEW_IMPORTATION">Нов внос</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Offer Sale Type Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Тип на обявата
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <select class="form-control form-control-sm"
                                                                    id="offerSaleType" name="offerSaleType">
                                                                <option value="">Всички</option>
                                                                <option value="SALE">За продан</option>
                                                                <option value="FOR_RENT">Под наем</option>
                                                                <option value="SERVICES">Услуги</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Price Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Цена
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <div class="filter-price">
                                                                <div class="filter-price__slider"></div>
                                                                <div class="filter-price__title">Цена: <input
                                                                        type="number"
                                                                        class="form-control form-control-sm"
                                                                        id="minPrice" name="minPrice"> – <input
                                                                        type="number"
                                                                        class="form-control form-control-sm"
                                                                        id="maxPrice" name="maxPrice"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Bulgarian Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Български ли да е?
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <select class="form-control form-control-sm" id="bulgarian"
                                                                    name="bulgarian">
                                                                <option value="">Всички</option>
                                                                <option value="true">Да</option>
                                                                <option value="false">Не</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Sort By Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Сортирай
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <select class="form-control form-control-sm" id="offerSort"
                                                                    name="offerSort">
                                                                <option value="def">По подразбиране
                                                                </option>
                                                                <option value="alphaDesc">По азбучен ред</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Items per Page Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Брой обяви на страница
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <select class="form-control form-control-sm"
                                                                    id="pageSizeSelect" name="size">
                                                                <option value="3">3</option>
                                                                <option value="5">5</option>
                                                                <option value="10">10</option>
                                                                <option value="15">15</option>
                                                                <option value="20">20</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Search Filter -->
                                            <div class="widget-filters__item">
                                                <div class="filter filter--opened" data-collapse-item>
                                                    <button type="button" class="filter__title" data-collapse-trigger>
                                                        Търсене
                                                        <svg class="filter__arrow" width="12px" height="7px">
                                                            <use xlink:href="images/sprite.svg#arrow-rounded-down-12x7"></use>
                                                        </svg>
                                                    </button>
                                                    <div class="filter__body" data-collapse-content>
                                                        <div class="filter__container">
                                                            <input type="text" class="form-control form-control-sm"
                                                                   id="search" name="search"
                                                                   placeholder="Ключова дума за търсене...">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="widget-filters__actions d-flex">
                                            <button type="submit" class="btn btn-primary">Филтрирай</button>
                                        </div>
                                        <div class="widget-filters__actions d-flex">
                                            <button type="button" class="btn btn-primary"
                                                    onclick="window.location.href='/offers'">
                                                Изчисти филтрите
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="shop-layout__content">
                    <div class="block">
                        <div class="products-view">
                            <div class="products-view__options">
                                <div class="view-options view-options--offcanvas--mobile">
                                    <div class="view-options__filters-button">
                                        <button type="button" class="filters-button">
                                            <svg class="filters-button__icon" width="16px" height="16px">
                                                <use xlink:href="images/sprite.svg#filters-16"></use>
                                            </svg>
                                            <span class="filters-button__title">Филтри</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="products-view__list products-list" data-layout="list" data-with-features="false"
                                 data-mobile-grid-columns="2">
                                <div class="products-list__body">
                                    <!--                                    PRODUCT ITEM-->
                                    <!--                                    PRODUCT ITEM-->
                                    <!--                                    PRODUCT ITEM-->
                                    <!--                                    PRODUCT ITEM-->

                                    <div th:each="offer : ${offers}" class="products-list__item">
                                        <div class="product-card product-card--hidden-actions">
                                            <div class="product-card__badges-list">
                                                <div th:switch="${offer.offerState.name()}">
                                                    <div th:case="'NEW'"
                                                         class="product-card__badge product-card__badge--new">НОВ
                                                    </div>
                                                    <div th:case="'NEW_IMPORTATION'"
                                                         class="product-card__badge product-card__badge--hot">НОВ ВНОС
                                                    </div>
                                                    <div th:case="'USED'"
                                                         class="product-card__badge product-card__badge--sale">
                                                        ИЗПОЛЗВАНО
                                                    </div>
                                                </div>
                                                <div th:switch="${offer.OfferSaleType.name()}">
                                                    <div th:case="'SALE'"
                                                         class="product-card__badge product-card__badge--new">ЗА ПРОДАН
                                                    </div>
                                                    <div th:case="'FOR_RENT'"
                                                         class="product-card__badge product-card__badge--hot">ПОД НАЕМ
                                                    </div>
                                                    <div th:case="'SERVICES'"
                                                         class="product-card__badge product-card__badge--sale">УСЛУГИ
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="product-card__image product-image">
                                                <a class="product-image__body">
                                                    <img th:src="@{${offer.mainPicture.path}}"
                                                         class="product-image__img" alt="">
                                                </a>
                                            </div>
                                            <div class="product-card__info">
                                                <div class="product-card__name">
                                                    <a th:href="@{/offers/{id}(id=${offer.id})}"
                                                       th:text="${offer.title}"></a>
                                                </div>
                                                <ul class="product-card__features-list">
                                                    <li th:text="'Българско : ' + (${offer.isBulgarian} ? 'ДА' : 'НЕ')"></li>
                                                    <li th:if="${offer.model != null}"
                                                        th:text="'Модел: ' + ${offer.model}"></li>
                                                    <li th:if="${offer.manufactureYear != null}"
                                                        th:text="'Година на производство: ' + ${offer.manufactureYear}"></li>
                                                    <li th:text="'Телефонен номер : ' + ${offer.phoneNumber}"></li>
                                                    <li th:text="'Собственик на обявата : ' + ${offer.owner.name} + ' ' + ${offer.owner.surname}"></li>
                                                </ul>
                                            </div>
                                            <div class="product-card__actions">
                                                <div class="product-card__prices"
                                                     th:text="'Цена: ' + ${offer.price} + ' лв.'"></div>
                                                <div class="product-card__buttons">
                                                    <a href="#" th:href="@{/offers/{id}(id=${offer.id})}"
                                                       class="btn btn-secondary product-card__addtocart product-card__addtocart--list">
                                                        Прочети повече
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pagination">
                                        <!-- Previous Page Link -->
                                        <div th:if="${offers.hasPrevious()}">
                                            <a th:href="@{/offers(page=${offers.number}, size=${offers.size})}"
                                               class="pagination__link">Предишна</a>
                                        </div>

                                        <!-- Page Number Display -->
                                        <span>Страница <span th:text="${offers.number + 1}"></span> от <span
                                                th:text="${offers.totalPages}"></span></span>

                                        <!-- Next Page Link -->
                                        <div th:if="${offers.hasNext()}">
                                            <a th:href="@{/offers(page=${offers.number + 2}, size=${offers.size})}"
                                               class="pagination__link">Следваща</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- site__body / end -->
<!-- site__footer -->
</div>
</div>
</div>
<th:block th:insert="~{fragments/footer}"></th:block>
<!-- Include the toast.js file -->
<script th:src="@{/js/toast.js}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const pageSizeSelect = document.getElementById('pageSizeSelect');

        // Function to reload page with new page size
        function updatePageSize(pageSize) {
            const currentPage = new URLSearchParams(window.location.search).get('page') || 1;
            window.location.href = `/offers?page=${currentPage}&size=${pageSize}`;
        }

        // Event listener for page size change
        pageSizeSelect.addEventListener('change', function() {
            const pageSize = pageSizeSelect.value;
            updatePageSize(pageSize);
        });

        // Set the initial value based on current page size
        const currentSize = new URLSearchParams(window.location.search).get('size') || 5;
        pageSizeSelect.value = currentSize;
    });
</script>

</body>
</html>